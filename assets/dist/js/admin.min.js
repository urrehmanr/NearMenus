(s=>{function n(){s(".menu-category").each(function(i){var e=s(this);e.find('input[name*="[name]"]').attr("name",`menu_categories[${i}][name]`),e.find(".menu-item").each(function(t){s(this).find("input, textarea, select").each(function(){var e=s(this).attr("name");e&&(e=e.replace(/menu_categories\[\d+\]\[items\]\[\d+\]/,`menu_categories[${i}][items][${t}]`),s(this).attr("name",e))})})})}function t(e,t){i(e),e.after('<div class="field-error">'+t+"</div>")}function i(e){e.siblings(".field-error").remove()}var e;s(document).ready(function(){var e,r;(e=s(".menu-builder")).length&&(s(document).on("click",".add-menu-category",function(e){e.preventDefault(),e=`
            <div class="menu-category">
                <div class="category-header">
                    <h4 class="category-title">New Category</h4>
                    <input type="hidden" name="menu_categories[${s(".menu-category").length}][name]" value="New Category">
                    <div class="category-actions">
                        <button type="button" class="button btn-small add-menu-item">Add Item</button>
                        <button type="button" class="button btn-small btn-danger remove-category">Remove</button>
                    </div>
                </div>
                <div class="menu-items"></div>
            </div>
        `,s(".menu-builder").append(e),n()}),s(document).on("click",".add-menu-item",function(e){e.preventDefault();var t,i,e=s(this).closest(".menu-category");t=(e=e).index(),i=e.find(".menu-item").length,t=`
            <div class="menu-item">
                <div class="menu-item-header">
                    <h5 class="menu-item-title">New Menu Item</h5>
                    <button type="button" class="button btn-small btn-danger remove-menu-item">Remove</button>
                </div>
                <div class="menu-item-fields">
                    <div class="menu-item-field">
                        <label>Item Name</label>
                        <input type="text" name="menu_categories[${t}][items][${i}][name]" value="New Menu Item" required>
                    </div>
                    <div class="menu-item-field">
                        <label>Price</label>
                        <input type="text" name="menu_categories[${t}][items][${i}][price]" placeholder="0.00">
                    </div>
                    <div class="menu-item-field menu-item-description">
                        <label>Description</label>
                        <textarea name="menu_categories[${t}][items][${i}][description]" rows="3"></textarea>
                    </div>
                    <div class="menu-item-field">
                        <label>Ingredients</label>
                        <input type="text" name="menu_categories[${t}][items][${i}][ingredients]" placeholder="List ingredients...">
                    </div>
                    <div class="menu-item-field">
                        <label>Calories</label>
                        <input type="number" name="menu_categories[${t}][items][${i}][calories]" min="0">
                    </div>
                    <div class="menu-item-options">
                        <label class="menu-item-checkbox">
                            <input type="checkbox" name="menu_categories[${t}][items][${i}][popular]" value="1">
                            Popular Item
                        </label>
                        <label class="menu-item-checkbox">
                            <input type="checkbox" name="menu_categories[${t}][items][${i}][vegetarian]" value="1">
                            Vegetarian
                        </label>
                        <label class="menu-item-checkbox">
                            <input type="checkbox" name="menu_categories[${t}][items][${i}][vegan]" value="1">
                            Vegan
                        </label>
                        <label class="menu-item-checkbox">
                            <input type="checkbox" name="menu_categories[${t}][items][${i}][gluten_free]" value="1">
                            Gluten Free
                        </label>
                    </div>
                </div>
            </div>
        `,e.find(".menu-items").append(t),n()}),s(document).on("click",".remove-category",function(e){e.preventDefault(),confirm("Are you sure you want to remove this category and all its items?")&&s(this).closest(".menu-category").remove()}),s(document).on("click",".remove-menu-item",function(e){e.preventDefault(),confirm("Are you sure you want to remove this menu item?")&&s(this).closest(".menu-item").remove()}),s(document).on("blur",".category-title-input",function(){var e=s(this).val().trim();e&&s(this).closest(".category-header").find(".category-title").text(e)}),s.fn.sortable)&&(e.sortable({handle:".category-header",items:".menu-category",placeholder:"category-placeholder",update:function(){n()}}),s(".menu-items").sortable({items:".menu-item",placeholder:"item-placeholder",update:function(){n()}})),s(document).on("click",".upload-image-btn",function(e){e.preventDefault();var i=s(this),n=i.siblings('input[type="hidden"]'),a=i.siblings(".image-preview");r||(r=wp.media.frames.file_frame=wp.media({title:"Choose Image",button:{text:"Choose Image"},multiple:!1})).on("select",function(){var e,t=r.state().get("selection").first().toJSON();n.val(t.url),t=t.url,e=i,a.html(`<img src="${t}" alt="Preview" class="menu-item-image-preview">`),e.hide(),e.siblings(".remove-image-btn").show()}),r.open()}),s(document).on("click",".remove-image-btn",function(e){e.preventDefault();var e=s(this),t=e.siblings('input[type="hidden"]'),i=e.siblings(".image-preview"),n=e.siblings(".upload-image-btn");t.val(""),i.empty(),n.show(),e.hide()}),s(".rating-field input").on("input",function(){var e=parseFloat(s(this).val()),t=s(this).siblings(".rating-stars");if(isNaN(e)||e<0)t.html("");else{for(var i="",n=1;n<=5;n++)i+=n<=e?"★":"☆";t.html(i)}}),s(".rating-field input").trigger("input"),s(".editinline").on("click",function(){var e=s(this).closest("tr").attr("id").replace("post-",""),t=s("#edit-"+e),i=s("#post-"+e).find(".rating-column").data("rating"),e=s("#post-"+e).find(".status-column").data("open");i&&t.find('input[name="restaurant_rating"]').val(i),e&&t.find('input[name="restaurant_currently_open"]').prop("checked","1"===e)}),s(".refresh-stats").on("click",function(e){e.preventDefault();var t=s(this);t.closest(".nearmenus-dashboard-widget");t.prop("disabled",!0).text("Refreshing..."),s.ajax({url:ajaxurl,type:"POST",data:{action:"nearmenus_refresh_stats",nonce:nearmenusAdmin.nonce},success:function(e){e.success&&location.reload()},complete:function(){t.prop("disabled",!1).text("Refresh")}})}),s(".file-upload-area").on("dragover dragenter",function(e){e.preventDefault(),s(this).addClass("dragover")}),s(".file-upload-area").on("dragleave",function(e){e.preventDefault(),s(this).removeClass("dragover")}),s(".file-upload-area").on("drop",function(e){e.preventDefault(),s(this).removeClass("dragover");e=e.originalEvent.dataTransfer.files;0<e.length&&(s(this).find('input[type="file"]')[0].files=e,s(this).find(".file-upload-label").text(e[0].name))}),s(".export-restaurants").on("click",function(e){e.preventDefault();var t=s(this);t.prop("disabled",!0).text("Exporting..."),window.location.href=ajaxurl+"?action=nearmenus_export_restaurants&nonce="+nearmenusAdmin.nonce,setTimeout(function(){t.prop("disabled",!1).text("Export Restaurants")},2e3)}),s('input[type="email"]').on("blur",function(){var e=s(this).val();e&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(s(this).addClass("error-field"),t(s(this),"Please enter a valid email address")):(s(this).removeClass("error-field"),i(s(this)))}),s('input[type="url"]').on("blur",function(){var e=s(this).val();e&&!/^https?:\/\/.+/.test(e)?(s(this).addClass("error-field"),t(s(this),"Please enter a valid URL (starting with http:// or https://)")):(s(this).removeClass("error-field"),i(s(this)))}),s('input[name*="rating"]').on("blur",function(){var e=parseFloat(s(this).val());s(this).val()&&(isNaN(e)||e<0||5<e)?(s(this).addClass("error-field"),t(s(this),"Rating must be between 0 and 5")):(s(this).removeClass("error-field"),i(s(this)))}),s('input[type="tel"]').on("blur",function(){var e=s(this).val();e&&!/^[\+]?[1-9][\d]{0,15}$/.test(e.replace(/[\s\-\(\)]/g,""))?(s(this).addClass("error-field"),t(s(this),"Please enter a valid phone number")):(s(this).removeClass("error-field"),i(s(this)))})}),s(document).on("keydown",function(e){(e.ctrlKey||e.metaKey)&&83===e.which&&(e.preventDefault(),s("#publish, #save-post").click()),(e.ctrlKey||e.metaKey)&&e.shiftKey&&65===e.which&&(e.preventDefault(),s(".add-menu-item:first").click())}),s.fn.tooltip&&s("[data-tooltip]").tooltip({content:function(){return s(this).data("tooltip")},position:{my:"left top+15",at:"left bottom"}}),s("input, textarea, select").on("change input",function(){clearTimeout(e),e=setTimeout(function(){"undefined"!=typeof autosave&&autosave()},5e3)})})(jQuery),window.nearmenusAdmin={addMenuCategory:function(){jQuery(".add-menu-category").trigger("click")},addMenuItem:function(e){jQuery(".menu-category").eq(e).find(".add-menu-item").trigger("click")},validateForm:function(){var e=!0;return jQuery("input[required], textarea[required], select[required]").each(function(){jQuery(this).val().trim()?jQuery(this).removeClass("error-field"):(jQuery(this).addClass("error-field"),e=!1)}),e=0<jQuery(".error-field").length?!1:e}};