(o=>{function a(){o(".menu-category").each(function(n){var e=o(this);e.find('input[name*="[name]"]').attr("name",`menu_categories[${n}][name]`),e.find(".menu-item").each(function(t){o(this).find("input, textarea, select").each(function(){var e=o(this).attr("name");e&&(e=e.replace(/menu_categories\[\d+\]\[items\]\[\d+\]/,`menu_categories[${n}][items][${t}]`),o(this).attr("name",e))})})})}function t(e,t){n(e),e.after('<div class="field-error">'+t+"</div>")}function n(e){e.siblings(".field-error").remove()}var e;o(document).ready(function(){var e,r;(e=o(".menu-builder")).length&&(o(document).on("click","#add-menu-category",function(e){e.preventDefault(),e=`
            <div class="menu-category" data-index="${e=o(".menu-category").length}">
                <h4>Menu Category</h4>
                <table class="widefat">
                    <tr>
                        <th><label>Category Name</label></th>
                        <td>
                            <input type="text" name="restaurant_menu[${e}][name]" value="" class="regular-text" placeholder="Enter category name" />
                            <button type="button" class="button remove-category">Remove Category</button>
                        </td>
                    </tr>
                </table>
                <div class="menu-items">
                    <h5>Menu Items</h5>
                    <button type="button" class="button add-menu-item">Add Item</button>
                </div>
            </div>
        `,o("#menu-categories").append(e),a()}),o(document).on("click",".add-menu-item",function(e){e.preventDefault();var t,n,e=o(this).closest(".menu-category");t=(e=e).data("index")||e.index(),n=e.find(".menu-item").length,t=`
            <div class="menu-item">
                <table class="widefat">
                    <tr>
                        <th>Item Name</th>
                        <td><input type="text" name="restaurant_menu[${t}][items][${n}][name]" value="" class="regular-text" placeholder="Enter item name" /></td>
                        <td rowspan="4"><button type="button" class="button remove-menu-item">Remove Item</button></td>
                    </tr>
                    <tr>
                        <th>Description</th>
                        <td><textarea name="restaurant_menu[${t}][items][${n}][description]" class="large-text" rows="2" placeholder="Item description"></textarea></td>
                    </tr>
                    <tr>
                        <th>Price</th>
                        <td><input type="number" step="0.01" name="restaurant_menu[${t}][items][${n}][price]" value="" class="regular-text" placeholder="0.00" /></td>
                    </tr>
                    <tr>
                        <th>Popular Item</th>
                        <td><input type="checkbox" name="restaurant_menu[${t}][items][${n}][popular]" value="1" /></td>
                    </tr>
                </table>
            </div>
        `,e.find(".menu-items").append(t),a()}),o(document).on("click",".remove-category",function(e){e.preventDefault(),confirm("Are you sure you want to remove this category and all its items?")&&o(this).closest(".menu-category").remove()}),o(document).on("click",".remove-menu-item",function(e){e.preventDefault(),confirm("Are you sure you want to remove this menu item?")&&o(this).closest(".menu-item").remove()}),o(document).on("blur",".category-title-input",function(){var e=o(this).val().trim();e&&o(this).closest(".category-header").find(".category-title").text(e)}),o.fn.sortable)&&(e.sortable({handle:".category-header",items:".menu-category",placeholder:"category-placeholder",update:function(){a()}}),o(".menu-items").sortable({items:".menu-item",placeholder:"item-placeholder",update:function(){a()}})),o(document).on("click",".upload-image-btn",function(e){e.preventDefault();var n=o(this),a=n.siblings('input[type="hidden"]'),i=n.siblings(".image-preview");r||(r=wp.media.frames.file_frame=wp.media({title:"Choose Image",button:{text:"Choose Image"},multiple:!1})).on("select",function(){var e,t=r.state().get("selection").first().toJSON();a.val(t.url),t=t.url,e=n,i.html(`<img src="${t}" alt="Preview" class="menu-item-image-preview">`),e.hide(),e.siblings(".remove-image-btn").show()}),r.open()}),o(document).on("click",".remove-image-btn",function(e){e.preventDefault();var e=o(this),t=e.siblings('input[type="hidden"]'),n=e.siblings(".image-preview"),a=e.siblings(".upload-image-btn");t.val(""),n.empty(),a.show(),e.hide()}),o(".rating-field input").on("input",function(){var e=parseFloat(o(this).val()),t=o(this).siblings(".rating-stars");if(isNaN(e)||e<0)t.html("");else{for(var n="",a=1;a<=5;a++)n+=a<=e?"★":"☆";t.html(n)}}),o(".rating-field input").trigger("input"),o(".editinline").on("click",function(){var e=o(this).closest("tr").attr("id").replace("post-",""),t=o("#edit-"+e),n=o("#post-"+e).find(".rating-column").data("rating"),e=o("#post-"+e).find(".status-column").data("open");n&&t.find('input[name="restaurant_rating"]').val(n),e&&t.find('input[name="restaurant_currently_open"]').prop("checked","1"===e)}),o(".refresh-stats").on("click",function(e){e.preventDefault();var t=o(this);t.closest(".nearmenus-dashboard-widget");t.prop("disabled",!0).text("Refreshing..."),o.ajax({url:ajaxurl,type:"POST",data:{action:"nearmenus_refresh_stats",nonce:nearmenusAdmin.nonce},success:function(e){e.success&&location.reload()},complete:function(){t.prop("disabled",!1).text("Refresh")}})}),o(".file-upload-area").on("dragover dragenter",function(e){e.preventDefault(),o(this).addClass("dragover")}),o(".file-upload-area").on("dragleave",function(e){e.preventDefault(),o(this).removeClass("dragover")}),o(".file-upload-area").on("drop",function(e){e.preventDefault(),o(this).removeClass("dragover");e=e.originalEvent.dataTransfer.files;0<e.length&&(o(this).find('input[type="file"]')[0].files=e,o(this).find(".file-upload-label").text(e[0].name))}),o(".export-restaurants").on("click",function(e){e.preventDefault();var t=o(this);t.prop("disabled",!0).text("Exporting..."),window.location.href=ajaxurl+"?action=nearmenus_export_restaurants&nonce="+nearmenusAdmin.nonce,setTimeout(function(){t.prop("disabled",!1).text("Export Restaurants")},2e3)}),o('input[type="email"]').on("blur",function(){var e=o(this).val();e&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(o(this).addClass("error-field"),t(o(this),"Please enter a valid email address")):(o(this).removeClass("error-field"),n(o(this)))}),o('input[type="url"]').on("blur",function(){var e=o(this).val();e&&!/^https?:\/\/.+/.test(e)?(o(this).addClass("error-field"),t(o(this),"Please enter a valid URL (starting with http:// or https://)")):(o(this).removeClass("error-field"),n(o(this)))}),o('input[name*="rating"]').on("blur",function(){var e=parseFloat(o(this).val());o(this).val()&&(isNaN(e)||e<0||5<e)?(o(this).addClass("error-field"),t(o(this),"Rating must be between 0 and 5")):(o(this).removeClass("error-field"),n(o(this)))}),o('input[type="tel"]').on("blur",function(){var e=o(this).val();e&&!/^[\+]?[1-9][\d]{0,15}$/.test(e.replace(/[\s\-\(\)]/g,""))?(o(this).addClass("error-field"),t(o(this),"Please enter a valid phone number")):(o(this).removeClass("error-field"),n(o(this)))})}),o(document).on("keydown",function(e){(e.ctrlKey||e.metaKey)&&83===e.which&&(e.preventDefault(),o("#publish, #save-post").click()),(e.ctrlKey||e.metaKey)&&e.shiftKey&&65===e.which&&(e.preventDefault(),o(".add-menu-item:first").click())}),o.fn.tooltip&&o("[data-tooltip]").tooltip({content:function(){return o(this).data("tooltip")},position:{my:"left top+15",at:"left bottom"}}),o("input, textarea, select").on("change input",function(){clearTimeout(e),e=setTimeout(function(){"undefined"!=typeof autosave&&autosave()},5e3)})})(jQuery),window.nearmenusAdmin={addMenuCategory:function(){jQuery(".add-menu-category").trigger("click")},addMenuItem:function(e){jQuery(".menu-category").eq(e).find(".add-menu-item").trigger("click")},validateForm:function(){var e=!0;return jQuery("input[required], textarea[required], select[required]").each(function(){jQuery(this).val().trim()?jQuery(this).removeClass("error-field"):(jQuery(this).addClass("error-field"),e=!1)}),e=0<jQuery(".error-field").length?!1:e}};